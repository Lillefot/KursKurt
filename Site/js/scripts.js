
window.onload = function(){
  console.log('Window loaded');
  goodRadioButton = document.getElementById('q1r1');
  badRadioButton = document.getElementById('q1r2');
  goodBadChoice = null;
  databasePHP = 'http://script.studieradet.se/kurskurt/database.php';

// Get userID from cas2.php via iframe login
  window.addEventListener('message',function(e) {
  var key = e.message ? 'message' : 'data';
  var data = e[key];
  window.localStorage.setItem("user", data);
  var user = window.localStorage.getItem("user");
  document.getElementById('user').value = user;
  console.log('User = ' + document.getElementById('user').value);
  },false);
}

// Clear eventList
eventList = null;

// Run parseICS.php to get all events and their end times from .ics file
//TODO: Get .ics file from Studentportalen
var parseICS = function(){
  console.log("parseICS");
  var xhr = new XMLHttpRequest();
  var url = "http://script.studieradet.se/kurskurt/parseICS.php";
  xhr.open("POST", url, true);
  xhr.setRequestHeader("Content-type", "application/json; charset=UTF-8");
  xhr.onreadystatechange = function () {
      //Run on success
      if (xhr.readyState === 4 && xhr.status === 200) {
          //Set icsArray of form to the eventList generated by parseICS.php
          eventList = JSON.parse(xhr.responseText);
          console.log("JSON responseText: " + eventList);
          document.getElementById('icsArray').value = eventList;
      }
  };
  xhr.send();
}

// Logs events in eventList
var listAllEvents = function () {
  console.log('icsArray: ' + document.getElementById('icsArray').value);
  for (var i in eventList) {
    console.log(eventList[i].title + " " + eventList[i].endTime);
  }
}

//Submits form to database
function submitForm() {
  console.log('Checking form!')

  //Set variables depending on good/bad choice
  if (goodRadioButton.checked){
    goodBadChoice = goodRadioButton.value;
  }
  else if (badRadioButton.checked) {
    goodBadChoice = badRadioButton.value;
  }

  //Check if user has chosen good/bad and then submits form
  if (goodBadChoice) {
  console.log('Submitting form!');
  console.log('goodBadChoice = ' + goodBadChoice);
  document.getElementById('fKurtForm').action = databasePHP;
  document.getElementById('fKurtForm').submit();
  console.log('Form submitted!');
  }
  //If good/bad not chosen
  else {
    alert('Fyll i om bra eller d√•lig!');
  }
}
